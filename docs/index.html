<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Highly Compressed Emoji Shortcodes</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <!-- shamelessly modified from http://bettermotherfuckingwebsite.com/ -->
    <style type="text/css">
      * {
        box-sizing: border-box;
      }
      body {
        margin: 40px auto;
        max-width: 650px;
        line-height: 1.6;
        font-size: 18px;
        color: #333;
        padding: 0 16px;
      }
      h1,
      h2,
      h3 {
        font-family: sans-serif;
        line-height: 1.2;
      }
      code {
        font-size: 0.9em;
      }
      #output {
        min-height: 32px;
        background-color: #eee;
        padding: 8px;
        margin: 16px 0px;
        border: 1px solid #767676;
        border-radius: 2px;
        width: 100%;
      }
      #output > p {
        margin: 0;
      }
    </style>
  </head>
  <body>
    <h2>
      <a
        href="https://github.com/daniel5151/compressed-emoji-shortcodes#iteration-and-further-ideas"
      >
        Highly Compressed Emoji Shortcodes
      </a>
    </h2>
    <p>
      This demo contains webassembly and javascript content, and may not work
      correctly on older browsers.
    </p>
    <hr />
    <p>
      For a more in-depth explanation of what's going on here, check out the
      <a href="https://prilik.com/blog/post/emoji-shortcodes/">writeup</a> on my
      blog, and the project's (very messy) source code on
      <a
        href="https://github.com/daniel5151/compressed-emoji-shortcodes#iteration-and-further-ideas"
        >Github</a
      >.
    </p>
    <hr />
    <p>
      Pop open the sources tab, subtract the ~15kb of
      <a href=""><code>wasm-pack</code></a> overhead from the (uncompressed)
      <code>.wasm</code> file size, and you'll find that this shortcode-to-emoji
      lookup function only requires
      <b>
        ~20kb of static storage (code + data), with zero dynamic allocation.
      </b>
    </p>
    <p>
      For reference, a file of raw <code>(shortcode,emoji)</code> pairs would
      occupy ~32kb, and would need to be parsed into a dynamically-allocated map
      to be queried efficiently. Additionally, the hash-map generated by the
      <i>unmodified</i> <code>rust-phf</code> takes up a whopping ~100kb of
      <code>.rodata</code> and <code>.data.rel.ro</code>, though admittedly,
      much of that space is wasted on struct-padding, which could be mitigated
      by refactoring the library to use two arrays-of-structs instead of a
      single array-of-tuples.
    </p>

    <hr />
    <p>
      Go on, type in some shortcodes! Colons are optional, and can be omitted.
      <br />
      Some crowd favorites include: <code>:+1:</code>, <code>:smile:</code>,
      <code>:poop:</code>, <code>:tada:</code>
    </p>
    <p>
      This lookup function is generated from
      <a
        href="https://raw.githubusercontent.com/github/gemoji/master/db/emoji.json"
        >the same dataset</a
      >
      used by Github.
    </p>
    <input style="width: 160px;" type="text" id="lookup" />
    <div id="output"></div>
    <p>
      If you're feeling lucky, you can try spamming some input into the text box
      and trying to find a false positive! This demo uses 16-bit hashes for the
      keys, so it aught to be pretty difficult to find any "reasonable" false
      positives (i.e: one which is is only a mistake or two away from being a
      valid input).
    </p>
    <p>
      That said, it's pretty easy to <i>programmatically</i> find false
      positives. In fact, every time you refresh this page, I'll go ahead and
      find another false positive by randomly generating a bunch of strings and
      seeing if one of them returns an output! Oh hey, looks like
      <span id="sample">(still calculating...)</span>. Neat!
    </p>
    <p>
      Oh, and if you're interesting in stress-testing the function directly, you
      can access it by calling
      <code>window.shortcode_lookup</code>.
    </p>

    <script src="./bootstrap.js"></script>
  </body>
</html>
